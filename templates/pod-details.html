<!-- pod-details.html -->

{% extends "base.html" %}

{% load static %}

{% block content %}
    <div class="container-fluid mt-4">
        <div class="card shadow-lg p-4">
            <!-- Pod Header -->
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h4 class="mb-0">Pod Details: <span>{{ pod.metadata.name }}</span></h4>
                <div>
                    <a href="{% url 'all_pods_page' %}" class="btn btn-light btn-sm me-2">
                        <i class="bi bi-arrow-left-circle"></i> Back to Pods Overview
                    </a>
                    <!-- "View JSON" Button -->
                    <a href="{% url 'pod_details_json' namespace=pod.metadata.namespace pod_name=pod.metadata.name %}" class="btn btn-light btn-sm">
                        <i class="bi bi-filetype-json"></i> View JSON
                    </a>
                </div>
            </div>
            <!-- Pod Content -->
            <div class="card-body">
                <!-- Accordion for Sections -->
                <div class="accordion" id="podDetailsAccordion">
                    <!-- Metadata Section -->
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingMetadata">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseMetadata" aria-expanded="true"
                                    aria-controls="collapseMetadata">
                                <i class="bi bi-info-circle me-2"></i> Metadata
                            </button>
                        </h2>
                        <div id="collapseMetadata" class="accordion-collapse collapse show"
                             aria-labelledby="headingMetadata" data-bs-parent="#podDetailsAccordion">
                            <div class="accordion-body">
                                <!-- Metadata Content (Existing) -->
                                <div class="row">
                                    <div class="col-md-6">
                                        <table class="table table-hover table-striped mb-3">
                                            <tbody>
                                            <tr>
                                                <th scope="row">Name</th>
                                                <td>{{ pod.metadata.name }}</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Namespace</th>
                                                <td>{{ pod.metadata.namespace }}</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">UID</th>
                                                <td>{{ pod.metadata.uid }}</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Resource Version</th>
                                                <td>{{ pod.metadata.resource_version }}</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Creation Timestamp</th>
                                                <td>{{ pod.metadata.creation_timestamp|date:"D, d M Y H:i:s" }}</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Generate Name</th>
                                                <td>{{ pod.metadata.generate_name|default:"N/A" }}</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Labels</th>
                                                <td>
                                                    {% if pod.metadata.labels %}
                                                        {% for key, value in pod.metadata.labels.items %}
                                                            <span class="badge bg-secondary me-1">{{ key }}: <strong>{{ value }}</strong></span>
                                                        {% endfor %}
                                                    {% else %}
                                                        <span class="text-muted">No Labels</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Annotations</th>
                                                <td>
                                                    {% if pod.metadata.annotations %}
                                                        <button class="btn btn-sm btn-outline-primary" type="button"
                                                                data-bs-toggle="collapse"
                                                                data-bs-target="#annotationsCollapse"
                                                                aria-expanded="false"
                                                                aria-controls="annotationsCollapse">
                                                            View Annotations
                                                        </button>
                                                        <div class="collapse mt-2" id="annotationsCollapse">
                                                            <ul class="list-group list-group-flush">
                                                                {% for key, value in pod.metadata.annotations.items %}
                                                                    <li class="list-group-item">
                                                                        <strong>{{ key }}</strong>: {{ value }}
                                                                    </li>
                                                                {% endfor %}
                                                            </ul>
                                                        </div>
                                                    {% else %}
                                                        <span class="text-muted">No Annotations</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="col-md-6">
                                        <table class="table table-hover table-striped mb-3">
                                            <tbody>
                                            <tr>
                                                <th scope="row">Owner References</th>
                                                <td>
                                                    {% if pod.metadata.owner_references %}
                                                        <ul class="list-group list-group-flush">
                                                            {% for owner in pod.metadata.owner_references %}
                                                                <li class="list-group-item">
                                                                    <strong>Kind:</strong> {{ owner.kind }}<br>
                                                                    <strong>Name:</strong> {{ owner.name }}<br>
                                                                    <strong>UID:</strong> {{ owner.uid }}
                                                                </li>
                                                            {% endfor %}
                                                        </ul>
                                                    {% else %}
                                                        <span class="text-muted">No Owner References</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Managed Fields</th>
                                                <td>
                                                    {% if pod.metadata.managed_fields %}
                                                        <button class="btn btn-sm btn-outline-secondary" type="button"
                                                                data-bs-toggle="collapse"
                                                                data-bs-target="#managedFieldsCollapse"
                                                                aria-expanded="false"
                                                                aria-controls="managedFieldsCollapse">
                                                            View Managed Fields
                                                        </button>
                                                        <div class="collapse mt-2" id="managedFieldsCollapse">
                                                            {% for field in pod.metadata.managed_fields %}
                                                                <div class="mb-3">
                                                                    <h6>{{ field.manager }} <small class="text-muted">{{ field.operation }}</small></h6>
                                                                    <p><strong>API Version:</strong> {{ field.api_version }}</p>
                                                                    <p><strong>Time:</strong> {{ field.time|date:"D, d M Y H:i:s" }}</p>
                                                                    <pre style="max-width: 50em; white-space: pre-wrap; word-wrap: break-word;">{{ field.fields_v1|safe }}</pre>
                                                                </div>
                                                            {% endfor %}
                                                        </div>
                                                    {% else %}
                                                        <span class="text-muted">No Managed Fields</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Self Link</th>
                                                <td>{{ pod.metadata.self_link|default:"N/A" }}</td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Specification Section -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingSpec">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapseSpec" aria-expanded="false"
                                        aria-controls="collapseSpec">
                                    <i class="bi bi-card-text me-2"></i> Specification
                                </button>
                            </h2>
                            <div id="collapseSpec" class="accordion-collapse collapse"
                                 aria-labelledby="headingSpec" data-bs-parent="#podDetailsAccordion">
                                <div class="accordion-body">
                                    <!-- Specification Content (Existing) -->
                                    <div class="table-responsive">
                                        <table class="table table-hover table-striped">
                                            <tbody>
                                            <tr>
                                                <th scope="row">Restart Policy</th>
                                                <td>{{ pod.spec.restart_policy }}</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">DNS Policy</th>
                                                <td>{{ pod.spec.dns_policy|default:"N/A" }}</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Service Account</th>
                                                <td>{{ pod.spec.service_account|default:"N/A" }}</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Node Name</th>
                                                <td>{{ pod.spec.node_name }}</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Node Selector</th>
                                                <td>
                                                    {% if pod.spec.node_selector %}
                                                        {% for key, value in pod.spec.node_selector.items %}
                                                            <span class="badge bg-secondary me-1">{{ key }}: <strong>{{ value }}</strong></span>
                                                        {% endfor %}
                                                    {% else %}
                                                        <span class="text-muted">No Node Selector</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Tolerations</th>
                                                <td>
                                                    {% if pod.spec.tolerations %}
                                                        {% for tol in pod.spec.tolerations %}
                                                            <span class="badge bg-info text-dark me-1">
                                                                {{ tol.key|default:"N/A" }}: {{ tol.effect|default:"N/A" }}
                                                            </span>
                                                        {% endfor %}
                                                    {% else %}
                                                        <span class="text-muted">No Tolerations</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Priority Class</th>
                                                <td>{{ pod.spec.priority_class_name|default:"N/A" }}</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Volumes</th>
                                                <td>
                                                    {% if pod.spec.volumes %}
                                                        <ul class="list-group list-group-flush">
                                                            {% for volume in pod.spec.volumes %}
                                                                <li class="list-group-item">
                                                                    <strong>{{ volume.name }}</strong>:
                                                                    {% if volume.host_path %}
                                                                        HostPath - Path: {{ volume.host_path.path }}
                                                                    {% elif volume.secret %}
                                                                        Secret - Name: {{ volume.secret.secret_name }}
                                                                    {% elif volume.projected %}
                                                                        Projected Volume
                                                                    {% else %}
                                                                        Other
                                                                    {% endif %}
                                                                </li>
                                                            {% endfor %}
                                                        </ul>
                                                    {% else %}
                                                        <span class="text-muted">No Volumes</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            <!-- Add more specification fields as needed -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Containers Section -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingContainers">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapseContainers" aria-expanded="false"
                                        aria-controls="collapseContainers">
                                    <i class="bi bi-box-seam me-2"></i> Containers
                                </button>
                            </h2>
                            <div id="collapseContainers" class="accordion-collapse collapse"
                                 aria-labelledby="headingContainers" data-bs-parent="#podDetailsAccordion">
                                <div class="accordion-body">
                                    <!-- Containers Content (Existing) -->
                                    {% for container in pod.spec.containers %}
                                        <div class="card mb-3">
                                            <div class="card-header bg-secondary text-white">
                                                <h5 class="mb-0">{{ container.name }}</h5>
                                            </div>
                                            <div class="card-body">
                                                <table class="table table-hover table-striped mb-3">
                                                    <tbody>
                                                    <tr>
                                                        <th scope="row">Image</th>
                                                        <td>{{ container.image }}</td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row">Image Pull Policy</th>
                                                        <td>{{ container.image_pull_policy }}</td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row">Command</th>
                                                        <td>
                                                            {% if container.command %}
                                                                {{ container.command | join:" " }}
                                                            {% else %}
                                                                <span class="text-muted">No Command</span>
                                                            {% endif %}
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row">Args</th>
                                                        <td>
                                                            {% if container.args %}
                                                                {{ container.args | join:" " }}
                                                            {% else %}
                                                                <span class="text-muted">No Args</span>
                                                            {% endif %}
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row">Environment Variables</th>
                                                        <td>
                                                            {% if container.env %}
                                                                <ul class="list-group list-group-flush">
                                                                    {% for env_var in container.env %}
                                                                        <li class="list-group-item">
                                                                            <strong>{{ env_var.name }}</strong>:
                                                                            {% if env_var.value %}
                                                                                {{ env_var.value }}
                                                                            {% elif env_var.value_from %}
                                                                                {% if env_var.value_from.field_ref %}
                                                                                    <em>From Field:</em> {{ env_var.value_from.field_ref.field_path }}
                                                                                {% elif env_var.value_from.config_map_key_ref %}
                                                                                    <em>From ConfigMap:</em> {{ env_var.value_from.config_map_key_ref.name }} - Key: {{ env_var.value_from.config_map_key_ref.key }}
                                                                                {% elif env_var.value_from.secret_key_ref %}
                                                                                    <em>From Secret:</em> {{ env_var.value_from.secret_key_ref.name }} - Key: {{ env_var.value_from.secret_key_ref.key }}
                                                                                {% else %}
                                                                                    <span class="text-muted">N/A</span>
                                                                                {% endif %}
                                                                            {% else %}
                                                                                <span class="text-muted">N/A</span>
                                                                            {% endif %}
                                                                        </li>
                                                                    {% endfor %}
                                                                </ul>
                                                            {% else %}
                                                                <span class="text-muted">No Environment Variables</span>
                                                            {% endif %}
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row">Ports</th>
                                                        <td>
                                                            {% if container.ports %}
                                                                <table class="table table-sm table-bordered">
                                                                    <thead>
                                                                    <tr>
                                                                        <th>Port</th>
                                                                        <th>Name</th>
                                                                        <th>Protocol</th>
                                                                    </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                    {% for port in container.ports %}
                                                                        <tr>
                                                                            <td>{{ port.container_port }}</td>
                                                                            <td>{{ port.name|default:"N/A" }}</td>
                                                                            <td>{{ port.protocol }}</td>
                                                                        </tr>
                                                                    {% endfor %}
                                                                    </tbody>
                                                                </table>
                                                            {% else %}
                                                                <span class="text-muted">No Ports</span>
                                                            {% endif %}
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row">Resources</th>
                                                        <td>
                                                            {% if container.resources %}
                                                                <strong>Requests:</strong>
                                                                {% if container.resources.requests %}
                                                                    <ul>
                                                                        {% for key, value in container.resources.requests.items %}
                                                                            <li>{{ key }}: {{ value }}</li>
                                                                        {% endfor %}
                                                                    </ul>
                                                                {% else %}
                                                                    <span class="text-muted">No Requests</span>
                                                                {% endif %}
                                                                <strong>Limits:</strong>
                                                                {% if container.resources.limits %}
                                                                    <ul>
                                                                        {% for key, value in container.resources.limits.items %}
                                                                            <li>{{ key }}: {{ value }}</li>
                                                                        {% endfor %}
                                                                    </ul>
                                                                {% else %}
                                                                    <span class="text-muted">No Limits</span>
                                                                {% endif %}
                                                            {% else %}
                                                                <span class="text-muted">No Resources</span>
                                                            {% endif %}
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row">Volume Mounts</th>
                                                        <td>
                                                            {% if container.volume_mounts %}
                                                                <ul class="list-group list-group-flush">
                                                                    {% for mount in container.volume_mounts %}
                                                                        <li class="list-group-item">
                                                                            <strong>{{ mount.name }}</strong>:
                                                                            Path: {{ mount.mount_path }},
                                                                            Read Only: {{ mount.read_only|yesno:"Yes,No" }}
                                                                        </li>
                                                                    {% endfor %}
                                                                </ul>
                                                            {% else %}
                                                                <span class="text-muted">No Volume Mounts</span>
                                                            {% endif %}
                                                        </td>
                                                    </tr>
                                                    <!-- Add more container fields as needed -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    {% endfor %}

                                    {% if pod.spec.init_containers %}
                                        <h5 class="mt-4">Init Containers</h5>
                                        {% for init_container in pod.spec.init_containers %}
                                            <div class="card mb-3">
                                                <div class="card-header bg-info text-white">
                                                    <h5 class="mb-0">{{ init_container.name }}</h5>
                                                </div>
                                                <div class="card-body">
                                                    <table class="table table-hover table-striped mb-3">
                                                        <tbody>
                                                        <tr>
                                                            <th scope="row">Image</th>
                                                            <td>{{ init_container.image }}</td>
                                                        </tr>
                                                        <tr>
                                                            <th scope="row">Image Pull Policy</th>
                                                            <td>{{ init_container.image_pull_policy }}</td>
                                                        </tr>
                                                        <tr>
                                                            <th scope="row">Command</th>
                                                            <td>
                                                                {% if init_container.command %}
                                                                    {{ init_container.command | join:" " }}
                                                                {% else %}
                                                                    <span class="text-muted">No Command</span>
                                                                {% endif %}
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <th scope="row">Args</th>
                                                            <td>
                                                                {% if init_container.args %}
                                                                    {{ init_container.args | join:" " }}
                                                                {% else %}
                                                                    <span class="text-muted">No Args</span>
                                                                {% endif %}
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <th scope="row">Environment Variables</th>
                                                            <td>
                                                                {% if init_container.env %}
                                                                    <ul class="list-group list-group-flush">
                                                                        {% for env_var in init_container.env %}
                                                                            <li class="list-group-item">
                                                                                <strong>{{ env_var.name }}</strong>:
                                                                                {% if env_var.value %}
                                                                                    {{ env_var.value }}
                                                                                {% elif env_var.value_from %}
                                                                                    {% if env_var.value_from.field_ref %}
                                                                                        <em>From Field:</em> {{ env_var.value_from.field_ref.field_path }}
                                                                                    {% elif env_var.value_from.config_map_key_ref %}
                                                                                        <em>From ConfigMap:</em> {{ env_var.value_from.config_map_key_ref.name }} - Key: {{ env_var.value_from.config_map_key_ref.key }}
                                                                                    {% elif env_var.value_from.secret_key_ref %}
                                                                                        <em>From Secret:</em> {{ env_var.value_from.secret_key_ref.name }} - Key: {{ env_var.value_from.secret_key_ref.key }}
                                                                                    {% else %}
                                                                                        <span class="text-muted">N/A</span>
                                                                                    {% endif %}
                                                                                {% else %}
                                                                                    <span class="text-muted">N/A</span>
                                                                                {% endif %}
                                                                            </li>
                                                                        {% endfor %}
                                                                    </ul>
                                                                {% else %}
                                                                    <span class="text-muted">No Environment Variables</span>
                                                                {% endif %}
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <th scope="row">Volume Mounts</th>
                                                            <td>
                                                                {% if init_container.volume_mounts %}
                                                                    <ul class="list-group list-group-flush">
                                                                        {% for mount in init_container.volume_mounts %}
                                                                            <li class="list-group-item">
                                                                                <strong>{{ mount.name }}</strong>:
                                                                                Path: {{ mount.mount_path }},
                                                                                Read Only: {{ mount.read_only|yesno:"Yes,No" }}
                                                                            </li>
                                                                        {% endfor %}
                                                                    </ul>
                                                                {% else %}
                                                                    <span class="text-muted">No Volume Mounts</span>
                                                                {% endif %}
                                                            </td>
                                                        </tr>
                                                        <!-- Add more init container fields as needed -->
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Status Section -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingStatus">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapseStatus" aria-expanded="false"
                                        aria-controls="collapseStatus">
                                    <i class="bi bi-bar-chart-line me-2"></i> Status
                                </button>
                            </h2>
                            <div id="collapseStatus" class="accordion-collapse collapse"
                                 aria-labelledby="headingStatus" data-bs-parent="#podDetailsAccordion">
                                <div class="accordion-body">
                                    <!-- Status Content (Existing) -->
                                    <div class="row">
                                        <div class="col-md-6">
                                            <table class="table table-hover table-striped mb-3">
                                                <tbody>
                                                <tr>
                                                    <th scope="row">Phase</th>
                                                    <td>
                                                        {% if pod.status.phase == "Running" %}
                                                            <span class="badge bg-success">{{ pod.status.phase }}</span>
                                                        {% elif pod.status.phase == "Pending" %}
                                                            <span class="badge bg-warning text-dark">{{ pod.status.phase }}</span>
                                                        {% else %}
                                                            <span class="badge bg-danger">{{ pod.status.phase }}</span>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Host IP</th>
                                                    <td>{{ pod.status.host_ip }}</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Pod IP</th>
                                                    <td>{{ pod.status.pod_ip }}</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">QoS Class</th>
                                                    <td>{{ pod.status.qos_class }}</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Start Time</th>
                                                    <td>{{ pod.status.start_time|date:"D, d M Y H:i:s" }}</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Conditions</th>
                                                    <td>
                                                        {% if pod.status.conditions %}
                                                            <div class="table-responsive">
                                                                <table class="table table-bordered table-sm">
                                                                    <thead class="table-light">
                                                                    <tr>
                                                                        <th>Type</th>
                                                                        <th>Status</th>
                                                                        <th>Last Transition</th>
                                                                        <th>Message</th>
                                                                        <th>Reason</th>
                                                                    </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                    {% for condition in pod.status.conditions %}
                                                                        <tr>
                                                                            <td>{{ condition.type }}</td>
                                                                            <td>
                                                                                {% if condition.status == "True" %}
                                                                                    <span class="badge bg-success">{{ condition.status }}</span>
                                                                                {% elif condition.status == "False" %}
                                                                                    <span class="badge bg-danger">{{ condition.status }}</span>
                                                                                {% else %}
                                                                                    <span class="badge bg-warning text-dark">{{ condition.status }}</span>
                                                                                {% endif %}
                                                                            </td>
                                                                            <td>{{ condition.last_transition_time|date:"D, d M Y H:i:s" }}</td>
                                                                            <td>{{ condition.message|default:"N/A" }}</td>
                                                                            <td>{{ condition.reason|default:"N/A" }}</td>
                                                                        </tr>
                                                                    {% endfor %}
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        {% else %}
                                                            <span class="text-muted">No Conditions</span>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="col-md-6">
                                            <table class="table table-hover table-striped mb-3">
                                                <tbody>
                                                <tr>
                                                    <th scope="row">Container Statuses</th>
                                                    <td>
                                                        {% if pod.status.container_statuses %}
                                                            {% for cstatus in pod.status.container_statuses %}
                                                                <div class="mb-2">
                                                                    <h6>{{ cstatus.name }}
                                                                        {% if cstatus.ready %}
                                                                            <span class="badge bg-success">Ready</span>
                                                                        {% else %}
                                                                            <span class="badge bg-danger">Not Ready</span>
                                                                        {% endif %}
                                                                    </h6>
                                                                    <ul class="list-group list-group-flush">
                                                                        <li class="list-group-item"><strong>Image:</strong> {{ cstatus.image }}</li>
                                                                        <li class="list-group-item"><strong>Image ID:</strong> {{ cstatus.image_id }}</li>
                                                                        <li class="list-group-item"><strong>Container ID:</strong> {{ cstatus.container_id }}</li>
                                                                        <li class="list-group-item"><strong>Restart Count:</strong> {{ cstatus.restart_count }}</li>
                                                                        <li class="list-group-item">
                                                                            <strong>State:</strong>
                                                                            {% if cstatus.state.running %}
                                                                                Running since {{ cstatus.state.running.started_at|date:"D, d M Y H:i:s" }}
                                                                            {% elif cstatus.state.terminated %}
                                                                                Terminated
                                                                            {% elif cstatus.state.waiting %}
                                                                                Waiting
                                                                            {% else %}
                                                                                Unknown
                                                                            {% endif %}
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                            {% endfor %}
                                                        {% else %}
                                                            <span class="text-muted">No Container Statuses</span>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Host IPs</th>
                                                    <td>
                                                        {% if pod.status.host_ips %}
                                                            <ul class="list-group list-group-flush">
                                                                {% for host_ip in pod.status.host_ips %}
                                                                    <li class="list-group-item">{{ host_ip.ip }}</li>
                                                                {% endfor %}
                                                            </ul>
                                                        {% else %}
                                                            <span class="text-muted">No Host IPs</span>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Pod IPs</th>
                                                    <td>
                                                        {% if pod.status.pod_ips %}
                                                            <ul class="list-group list-group-flush">
                                                                {% for pod_ip in pod.status.pod_ips %}
                                                                    <li class="list-group-item">{{ pod_ip.ip }}</li>
                                                                {% endfor %}
                                                            </ul>
                                                        {% else %}
                                                            <span class="text-muted">No Pod IPs</span>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                <!-- Add more status fields as needed -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Real-Time Logs Section (Updated) -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingLogs">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapseLogs" aria-expanded="false"
                                        aria-controls="collapseLogs">
                                    <i class="bi bi-stickies me-2"></i> Real-Time Logs
                                </button>
                            </h2>
                            <div id="collapseLogs" class="accordion-collapse collapse"
                                 aria-labelledby="headingLogs" data-bs-parent="#podDetailsAccordion">
                                <div class="accordion-body">
                                    <!-- Container Selection Dropdown -->
                                    {% if containers|length > 1 %}
                                        <div class="mb-3">
                                            <label for="container-select" class="form-label">Select Container:</label>
                                            <select id="container-select" class="form-select">
                                                {% for container in containers %}
                                                    <option value="{{ container }}">{{ container }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    {% elif containers|length == 1 %}
                                        <input type="hidden" id="container-select" value="{{ containers.0 }}">
                                    {% endif %}

                                    <!-- Log Container -->
                                    <div id="log-container" class="mb-3">
                                        <!-- Logs will be appended here -->
                                    </div>

                                    <!-- Optional: Log Controls -->
                                    <button id="pause-logs" class="btn btn-sm btn-outline-secondary me-2">Pause Logs</button>
                                    <button id="resume-logs" class="btn btn-sm btn-outline-secondary">Resume Logs</button>
                                </div>
                            </div>
                        </div>

                        <!-- Additional Sections (e.g., Events) can be added similarly -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SSE and Log Handling Scripts (Updated) -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const namespace = "{{ selected_namespace }}";
            const podName = "{{ pod_name }}";
            const containers = {{ containers|safe }}; // Array of container names
            const logContainer = document.getElementById('log-container');
            const pauseButton = document.getElementById('pause-logs');
            const resumeButton = document.getElementById('resume-logs');
            const containerSelect = document.getElementById('container-select');
            let eventSource = null;
            let isPaused = false;

            // Function to initialize SSE connection
            function initSSE(containerName) {
                if (!containerName) {
                    console.error("No container name provided.");
                    logContainer.innerHTML = "<div class='log-error'>No container selected.</div>";
                    return;
                }

                // Construct the SSE URL with URL encoding
                const sse_url = `/pods/${encodeURIComponent(namespace)}/${encodeURIComponent(podName)}/stream-logs/${encodeURIComponent(containerName)}/`;

                eventSource = new EventSource(sse_url);

                eventSource.onmessage = function (e) {
                    if (isPaused) return; // Do not append logs if paused

                    const data = JSON.parse(e.data);
                    const log = data.log;

                    // Determine log level for styling
                    let logClass = 'log-info'; // Default class
                    const upperLog = log.toUpperCase();
                    if (upperLog.includes('ERROR')) {
                        logClass = 'log-error';
                    } else if (upperLog.includes('WARNING') || upperLog.includes('WARN')) {
                        logClass = 'log-warning';
                    }

                    const logLine = document.createElement('div');
                    logLine.textContent = log;
                    logLine.classList.add(logClass);
                    logContainer.appendChild(logLine);
                    logContainer.scrollTop = logContainer.scrollHeight; // Auto-scroll to bottom
                };

                eventSource.onerror = function (e) {
                    console.error("SSE error:", e);
                    const errorLine = document.createElement('div');
                    errorLine.textContent = "Error receiving logs.";
                    errorLine.classList.add('log-error');
                    logContainer.appendChild(errorLine);
                    eventSource.close();
                };

                eventSource.onopen = function () {
                    console.log("SSE connection established.");
                    const statusLine = document.createElement('div');
                    statusLine.textContent = `Connected to log stream for container "${containerName}".`;
                    statusLine.classList.add('log-info');
                    logContainer.appendChild(statusLine);
                };
            }

            // Function to reset and initialize SSE
            function resetSSE(containerName) {
                if (eventSource) {
                    eventSource.close();
                }
                logContainer.innerHTML = ""; // Clear existing logs
                initSSE(containerName);
            }

            // Initialize SSE on page load
            if (containerSelect) {
                // If multiple containers, initialize with the first selected
                initSSE(containerSelect.value);

                // Listen for container selection changes
                containerSelect.addEventListener('change', function () {
                    const selectedContainer = this.value;
                    resetSSE(selectedContainer);
                });
            } else if (containers.length === 1) {
                // If only one container, initialize with it
                initSSE(containers[0]);
            }

            // Pause Logs
            pauseButton.addEventListener('click', function () {
                isPaused = true;
                logContainer.appendChild(createStatusLine("Log streaming paused.", 'log-warning'));
            });

            // Resume Logs
            resumeButton.addEventListener('click', function () {
                if (isPaused && eventSource.readyState !== EventSource.OPEN) {
                    // Reinitialize SSE connection if it was closed
                    if (containerSelect) {
                        resetSSE(containerSelect.value);
                    }
                }
                isPaused = false;
                logContainer.appendChild(createStatusLine("Log streaming resumed.", 'log-info'));
            });

            // Helper function to create status lines
            function createStatusLine(message, cssClass) {
                const statusLine = document.createElement('div');
                statusLine.textContent = message;
                statusLine.classList.add(cssClass);
                return statusLine;
            }

            // Optional: Clean up EventSource when navigating away
            window.addEventListener('beforeunload', function () {
                if (eventSource) {
                    eventSource.close();
                }
            });
        });
    </script>

    <style>
        /* Styles for the log container */
        #log-container {
            width: 100%;
            height: 50em;
            border: 1px solid #ccc;
            overflow-y: scroll;
            background-color: #000;
            color: #0f0;
            padding: 10px;
            font-family: monospace;
            white-space: pre-wrap;
        }

        /* Styles for different log levels */
        .log-error {
            color: #f00; /* Red for errors */
        }

        .log-warning {
            color: #ff0; /* Yellow for warnings */
        }

        .log-info {
            color: #0f0; /* Green for info */
        }
    </style>
{% endblock %}